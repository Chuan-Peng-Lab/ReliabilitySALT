---
title: "5_Plot"
author: "yuki"
date: "2023-05-04"
output: html_document
---
# Create NULL List
```{r Create NULL List}
plot <- list()
```


################################################################################
--------------------------------------------------------------------------------
################################################################################


# Normal SHR
```{r Read OUTPUT}
# 获取所有的nmshr
plot[[1]] <- list.files(file.path("./OUTPUT/nmshr/"),
                            pattern = "nmshr_.*\\.csv$",
                            ) %>%
  # 对读取到的所有.out文件x都执行函数read.table
  lapply(function(x) read.csv(file.path("./OUTPUT/nmshr/", x), header = TRUE)) %>% # nolint
  # 对所有被read.table处理过的数据执行dplyr的清洗
  lapply(function(df) dplyr::filter(df, Indice != "Indice")) %>%
  bind_rows() %>%
  dplyr::mutate(Target = case_when(Target == "Friend" ~ "Close",
                                   Target == "Partner" ~ "Close",
                                   Target == "Mother" ~ "Close",
                                   Target == "Father" ~ "Close",
                                   Target == "Acquaintance" ~ "Stranger",
                                   Target == "Stranger" ~ "Stranger",
                                   Target == "Celebrity" ~ "Celebrity",
                                   Target == "none" ~ "NonPerson",
                                   )
                ) %>%
  dplyr::mutate(Target = factor(Target,
                                levels = c("Close", "Stranger", "Celebrity", "NonPerson"), # nolint
                                ),
                Indice = factor(Indice,
                                levels = c("rwDDM z", "rwDDM v", "ezDDM z", "ezDDM v", "Efficiency", "d Prime", "ACC", "RT") # nolint
                                )
                )
names(plot)[1] <- "Normal SHR"
```

```{r Plot nmshr, warning=FALSE}
ggplot2::ggplot(plot[[1]],aes(x = Indice, y = r, fill = interaction(Indice, Target))) + 
  ggplot2::geom_boxplot(width = 0.1, position = position_nudge(x = -0.05), color = "grey", alpha = 0.5, outlier.color = NA,) +  
  see::geom_violinhalf(color = "grey", alpha = 0.5, position = position_nudge(x = 0.1)) + 
  ggdist::stat_dots(side = "left", justification = 1.2, alpha = 0.5) +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_y_continuous(limits = c(-0.1, 1.1),
                              breaks = c(0, 0.5, 0.7, 1),
                              sec.axis = sec_axis(~., breaks = c(0, 0.5, 0.7, 1),
                                                  labels = c("Unacceptable", "Poor", "Acceptable", "Excellent")),
                              ) +
  ggplot2::geom_hline(yintercept = 0, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::geom_hline(yintercept = 0.5, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::geom_hline(yintercept = 1, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::labs(y = "", x = "") +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none") +
  ggplot2::facet_wrap(~Target + Method, ncol = 3)

ggsave(filename = "./FIGURE/Fig1_nmshr.png",
       width = 20,
       height = 20,
       dpi = 300,
       )
```


################################################################################
--------------------------------------------------------------------------------
################################################################################


# Monte Carlo SHR
```{r Read OUTPUT}
# 获取所有的mcshr
plot[[2]] <- list.files(file.path("./OUTPUT/mcshr_5k/"),
                        pattern = "mcshr_.*\\.csv$",
                        ) %>%
  # 对读取到的所有.out文件x都执行函数read.table
  lapply(function(x) read.csv(file.path("./OUTPUT/mcshr_5k/", x), header = TRUE)) %>% # nolint
  # 对所有被read.table处理过的数据执行dplyr的清洗
  lapply(function(df) dplyr::filter(df, Indice != "Indice")) %>%
  bind_rows() %>%
  dplyr::mutate(Target = case_when(Target == "Friend" ~ "Close",
                                   Target == "Partner" ~ "Close",
                                   Target == "Mother" ~ "Close",
                                   Target == "Father" ~ "Close",
                                   Target == "Acquaintance" ~ "Stranger",
                                   Target == "Stranger" ~ "Stranger",
                                   Target == "Celebrity" ~ "Celebrity",
                                   Target == "none" ~ "NonPerson",
                                   )
                ) %>%
  #dplyr::filter(!stringr::str_detect(Indice, "ez")) %>%
  dplyr::mutate(Target = factor(Target,levels = c("Close", "Stranger", "Celebrity", "NonPerson")),
                Indice = factor(Indice,levels = c("rwDDM z", "rwDDM v", "ezDDM z", "ezDDM v", "Efficiency", "d Prime", "ACC", "RT")))
names(plot)[2] <- "Monte Carlo SHR"
```

```{r Plot SHR for Simulated Data, message= FALSE, warning = FALSE}
ggplot(plot[[2]], aes(x = Indice, y = r, group = Paper_ID, color = interaction(Indice, Target))) + # nolint
  ggplot2::geom_errorbar(aes(color = interaction(Indice, Target), ymin = LLCI, ymax = ULCI), width = 0.1, size = 1, position = position_dodge(width = 1)) + # nolint
  ggplot2::geom_point(size = 3, position = position_dodge(width = 1)) +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_y_continuous(limits = c(-0.1, 1.1),
                              breaks = c(0, 0.5, 0.7, 1),
                              sec.axis = sec_axis(~., breaks = c(0, 0.5, 0.7, 1),
                                                  labels = c("Unacceptable", "Poor", "Acceptable", "Excellent")),
                              ) +
  ggplot2::geom_hline(yintercept = 0, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 0.5, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 1, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::labs(y = "", x = "") +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none",
                 plot.margin = margin(r = 40),
                 axis.text.x.top = element_text(size = 30, angle = 30, hjust = 0), 
                 axis.text.x.bottom = element_text(size = 30),
                 axis.text.y.left = element_text(size = 30),
                 axis.title = element_blank(),
                 strip.text = element_text(size = 30),
                 ) +
  ggplot2::facet_wrap(~Target, ncol = 2)

ggsave(filename = "./FIGURE/Fig2_mcshr_5k_ez.png",
       width = 20,
       height = 25,
       dpi = 300,
       )
```


################################################################################
--------------------------------------------------------------------------------
################################################################################


# ICC
```{r Read OUTPUT}
# 获取所有的icc
plot[[3]] <- list.files(file.path("./OUTPUT/icc/"),
                        pattern = "icc_.*\\.csv$") %>%
  # 对读取到的所有.out文件x都执行函数read.table
  lapply(function(x) read.csv(file.path("./OUTPUT/icc/", x), header = TRUE)) %>% # nolint
  # 对所有被read.table处理过的数据执行dplyr的清洗
  lapply(function(df) dplyr::filter(df, type != "type")) %>%
  bind_rows() %>%
  dplyr::mutate(Target = case_when(Target == "Friend" ~ "Close",
                                   Target == "Partner" ~ "Close",
                                   Target == "Mother" ~ "Close",
                                   Target == "Father" ~ "Close",
                                   Target == "Acquaintance" ~ "Stranger",
                                   Target == "Stranger" ~ "Stranger",
                                   Target == "Celebrity" ~ "Celebrity",
                                   Target == "none" ~ "NonPerson",
                                   )
                ) %>%
  #dplyr::filter(!stringr::str_detect(ICC_type, "ez")) %>%
  dplyr::mutate(Target = factor(Target,levels = c("Close", "Stranger", "Celebrity", "NonPerson")),
                ICC_type = factor(ICC_type,
                                  levels = c("rwDDM z", "rwDDM v", "ezDDM z", "ezDDM v", "Efficiency", "d Prime", "ACC", "RT") 
                                  ))
names(plot)[3] <- "ICC"
```

# ICC
```{r Plot ICC, message= FALSE, warning = FALSE}
ggplot2::ggplot(plot[[3]], aes(x = ICC_type, y = ICC, group = Paper_ID, color = interaction(ICC_type, Target))) + # nolint
  ggplot2::geom_errorbar(aes(color = interaction(ICC_type, Target), ymin = LLCI, ymax = ULCI), width = 0.1, size = 1, position = position_dodge(width = 1)) + # nolint
  ggplot2::geom_point(size = 3, position = position_dodge(width = 1)) +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_x_discrete() +
  ggplot2::scale_y_continuous(limits = c(-0.1, 1.1),
                              breaks = c(0, 0.5, 0.7, 1),
                              sec.axis = sec_axis(~., breaks = c(0, 0.5, 0.7, 1),
                                                  labels = c("Unacceptable", "Poor", "Acceptable", "Excellent")),
                              ) +
  ggplot2::geom_hline(yintercept = 0, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 0.5, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 1, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::labs(y = "", x = "") +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none",
                 plot.margin = margin(r = 40),
                 axis.text.x.top = element_text(size = 30, angle = 30, hjust = 0), 
                 axis.text.x.bottom = element_text(size = 30),
                 axis.text.y.left = element_text(size = 30),
                 axis.title = element_blank(),
                 strip.text = element_text(size = 30),) +
  ggplot2::facet_wrap(~ type + Target, ncol = 3)

ggsave(filename = "./FIGURE/Fig3_icc_ez.png",
       width = 25,
       height = 25,
       )
```

# Trials Number
```{r}
plot[[4]] <- plot[[2]] %>%
  dplyr::left_join(desc[[1]], by = "Paper_ID") %>%
  dplyr::filter(Target == "Close" | Target == "Stranger") %>%
  dplyr::group_by(Target, Indice) %>%
  dplyr::mutate(cor = cor(r, Trials)) %>%
  dplyr::ungroup() %>%
  dplyr::distinct(Target, Indice, cor)  %>%
  dplyr::mutate(Target = factor(Target,levels = c("Close", "Stranger")),
                Indice = factor(Indice,levels = c("RT", "ACC", "d Prime", "Efficiency", "ezDDM v", "ezDDM z", "rwDDM v", "rwDDM z")))
```

```{r}
ggplot2::ggplot(plot[[4]], aes(x = Indice, y = cor)) +
  ggplot2::geom_bar(data = plot[[4]], aes(fill = Indice), alpha = 0.7, stat = "identity") +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_x_discrete() +
  ggplot2::scale_y_continuous(limits = c(-0, 1),
                              breaks = c(0.3, 0.7, 0.9),
                              sec.axis = sec_axis(~., breaks = c(0.3, 0.7, 0.9),
                                                  labels = c("Low", "Medium", "High"),
                                                  ),
                              ) +
  ggplot2::geom_hline(yintercept = 0.3, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::geom_hline(yintercept = 0.9, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::facet_wrap(~Target, ncol = 1) +
  ggplot2::labs(y = "", x = "") +
  #ggplot2::scale_fill_manual(values = c("#FEBE8C", "#97DBAE"))+ 
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none")

ggsave(filename = "./FIGURE/Fig4_trails.png",
       width = 7,
       height = 7,
       )
```

```{r}
plot[[5]] <- plot[[2]] %>%
  dplyr::left_join(desc[[1]], by = "Paper_ID") %>%
  dplyr::filter(Target == "Close" | Target == "Stranger") %>%
  dplyr::mutate(Target = factor(Target,levels = c("Close", "Stranger")),
                Indice = factor(Indice,levels = c("RT", "ACC", "d Prime", "Efficiency", "ezDDM v", "ezDDM z", "rwDDM v", "rwDDM z"))) %>%
  dplyr::mutate(r_8 = case_when(Target == "Close" & Indice == "RT" ~ 120,
                                Target == "Stranger" & Indice == "RT" ~ 75,
                                Target == "Close" & Indice == "ACC" ~ 130,
                                Target == "Close" & Indice == "Efficiency" ~ 110,
                                Target == "Stranger" & Indice == "Efficiency" ~ 80,
                                Target == "Close" & Indice == "ezDDM v" ~ 130,
                                Target == "Stranger" & Indice == "ezDDM v" ~ 119,
                                Target == "Close" & Indice == "rwDDM v" ~ 134,
                                TRUE ~ NA),
                )
```

```{r}
p1 <- plot[[5]] %>%
  dplyr::filter(!grepl("DDM", Indice)) %>%
  ggplot2::ggplot(data = ., aes(x = Trials, y = r, color = Indice, fill = Indice)) +
  ggplot2::geom_point() +  # 添加散点
  ggplot2::geom_smooth(method = "lm", se = TRUE, fullrange = TRUE) +  # 添加拟合曲线
  ggplot2::scale_x_continuous(limits = c(0, 140),
                              breaks = c(0, 30, 60, 100, 130),
                              ) +
  ggplot2::scale_y_continuous(limits = c(0, 1),
                              breaks = c(0, 0.5, 0.8, 1),
                              ) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Close" & Indice == "RT"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Stranger" & Indice == "RT"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Close" & Indice == "ACC"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Close" & Indice == "Efficiency"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Stranger" & Indice == "Efficiency"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_hline(yintercept = 0.8, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::facet_grid(cols = vars(Target), 
                      rows = vars(Indice)) +
  ggplot2::labs(y = "Monte-Carlo Split-Half Reliability", x = "Trial Numbers") +
  ggplot2::scale_color_manual(values = c("#F8766D", "#CD9600", "#7AAC00", "#03BE66")) +
  ggplot2::scale_fill_manual(values = c("#F8766D", "#CD9600", "#7AAC00", "#03BE66")) +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none")

p2 <- plot[[5]] %>%
  dplyr::filter(grepl("DDM", Indice)) %>%
  ggplot2::ggplot(data = ., aes(x = Trials, y = r, color = Indice, fill = Indice)) +
  ggplot2::geom_point() +  # 添加散点
  ggplot2::geom_smooth(method = "lm", se = TRUE, fullrange = TRUE) +  # 添加拟合曲线
  ggplot2::scale_x_continuous(limits = c(0, 140),
                              breaks = c(0, 30, 60, 100, 130),
                              ) +
  ggplot2::scale_y_continuous(limits = c(0, 1),
                              breaks = c(0, 0.5, 0.8, 1),
                              ) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Close" & Indice == "ezDDM v"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Stranger" & Indice == "ezDDM v"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_vline(data = subset(plot[[5]], Target == "Close" & Indice == "rwDDM v"),
                      aes(xintercept = r_8),
                      linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_hline(yintercept = 0.8, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + # nolint
  ggplot2::facet_grid(cols = vars(Target), 
                      rows = vars(Indice)) +
  ggplot2::labs(y = "", x = "Trial Numbers") +
  ggplot2::scale_color_manual(values = c("#00BFC4", "#00A8FF", "#C678FF", "#FF60CC")) +
  ggplot2::scale_fill_manual(values = c("#00BFC4", "#00A8FF", "#C678FF", "#FF60CC")) +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none")

p3 <- p1 + p2+plot_layout(guides = 'collect')

ggsave(filename = "./FIGURE/Fig5_regression.png",
       width = 10,
       height = 8,
       )
rm(p1, p2, p3)
```


