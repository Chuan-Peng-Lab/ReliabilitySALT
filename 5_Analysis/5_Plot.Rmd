---
title: "5_Plot"
author: "yuki"
date: "2023-05-04"
output: html_document
---
# Create NULL List
```{r Create NULL List}
plot <- list()
```

# Palette
```{r Palette}
warm <- c("#C848B9", "#F962A7","#F3533A", "#FD836D","#FA9F42", "#FFBA69")
cold <- c("#057748", "#3D9A8B", "#2EB19F", "#5ACFC9", "#63C2D2", "#B7EDFF")
palette <- list(warm = warm, cold = cold)
rm(warm, cold)
```

# SHR
```{r}
res[[1]][[3]] <- read.csv("./OUTPUT/formal_nmshr.csv") %>%
  dplyr::mutate(Target = case_when(Target == "Friend" ~ "Close",
                                   Target == "Partner" ~ "Close",
                                   Target == "Mother" ~ "Close",
                                   Target == "Father" ~ "Close",
                                   Target == "Acquaintance" ~ "Close",
                                   Target == "Stranger" ~ "Stranger",
                                   Target == "Celebrity" ~ "Celebrity",
                                   Target == "none" ~ "NonPerson",)) %>%
  dplyr::mutate(Target = factor(Target, levels = c("Close", "Stranger", "Celebrity", "NonPerson")),
                Indice = factor(Indice, levels = c("ezDDM: z", "ezDDM: v", "Efficiency", "Dprime", "ACC", "RT"))) 
names(res[[1]])[3] <- "plot"
```

```{r Plot nmshr, }
plot[[1]] <- ggplot2::ggplot(res[[1]][[3]], aes(x = Indice, y = r, fill = interaction(Indice, Target))) +
  ggplot2::geom_boxplot(width = 0.1, position = position_nudge(x = -0.05), color = "grey", alpha = 0.5, outlier.color = NA,) + 
  see::geom_violinhalf(color = "grey", alpha = 0.5, position = position_nudge(x = 0.1)) +
  ggdist::stat_dots(side = "left",justification = 1.2, alpha = 0.5) +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_y_continuous(limits = c(-0.5, 1.2), 
                     sec.axis = sec_axis(~., breaks = c(0, 0.5, 0.7, 1), 
                                             labels = c("unacceptable", "poor", "acceptable", "excellent")),
                                             breaks = seq(-0.4, 1,by = 0.2)) +
  ggplot2::geom_hline(yintercept = 0, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::geom_hline(yintercept = 0.5, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + #add dotted line
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_hline(yintercept = 1, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none") +
  ggplot2::labs(y = "Split-Half Reliability", x = "Indices") +
  #ggplot2::scale_fill_manual(values = c(palette$warm, palette$cold)) + 
  ggplot2::facet_wrap(~Target + Method, ncol = 3) 

names(plot)[1] <- "First-Second, Odd-Even, Permuted"

ggsave(filename="./FIGURE/Fig1_nmshr.png", width = 15, height = 15, dpi = 300)
```

```{r Plot SHR for Simulated Data, message= FALSE, warning = FALSE}
# only for testing codes
mcshr.fake <- read.csv("../OUTPUT/plot_mcshr_fake.csv") %>%
  dplyr::group_by(Indice, Target) %>%
  dplyr::arrange(r) %>%
  dplyr::mutate(Order = row_number()) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Indice = factor(Indice, levels = c("ezDDM: z", "ezDDM: v", "Efficiency", "Dprime", "ACC", "RT"))) %>%
  dplyr::arrange(Indice, Target, r)

plot[[2]] <- ggplot(mcshr.fake, aes(x = Indice, y = r, group = Order, color = interaction(Indice, Target))) +
  ggplot2::geom_errorbar(aes(ymin = LLCI, ymax = ULCI), width = 0.1, size = 2, position = position_dodge(width = 1)) +
  #geom_line() +
  ggplot2::geom_point(size = 5, position = position_dodge(width = 1)) +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_y_continuous(limits = c(0, 1), 
                              sec.axis = sec_axis(~., breaks = c(0.3, 0.5, 0.7, 1), 
                                                  labels = c("unacceptable", "poor","acceptable", "excellent")),
                              breaks = seq(0,1,by = 0.1)) +
  ggplot2::geom_hline(yintercept = 0.3, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::geom_hline(yintercept = 0.5, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + 
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_hline(yintercept = 1, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::theme_bw() +
  ggplot2::theme(legend.position = "none",
                 text = element_text(size = 20),
                 axis.text.x = element_text(size = 20),
                 axis.text.y = element_text(size = 20),
                 axis.title = element_text(size = 25),
                 axis.title.x = element_text(margin = margin(t = 20)),
                 axis.title.y = element_text(margin = margin(t = 10)),
                 plot.margin = unit(c(1,1,1,1), "cm"),
                 panel.grid = element_blank(),#hide the line in background
                 strip.background = element_rect(color = "black", fill = "white", size = 1)
                 ) +
  ggplot2::labs(y = "Monte Carlo-based Split-Half Reliability", x = "Indices") +
  ggplot2::scale_color_manual(values = c("black","black","black","black","black","black","grey","grey","grey","grey","grey","grey")) + 
  ggplot2::facet_wrap(~Target, ncol = 2) 

names(plot)[2] <- "Monte Carlo"

rm(mcshr.fake)

ggsave(filename="../FIGURE/Fig2_MC_SHR.png", width = 20, height = 15)
```


```{r}
res[[3]][[1]] <- res[[3]][[1]] %>%
  dplyr::mutate(Target = "Friend")
res[[3]][[2]] <- res[[3]][[2]] %>%
  dplyr::mutate(Target = "Stranger")
res[[3]][[3]] <- rbind(res[[3]][[1]], res[[3]][[2]]) %>%
  dplyr::mutate(ICC_type = factor(ICC_type, levels = c("ezDDM: z", "ezDDM: v", "Efficiency", "Dprime", "ACC", "RT"))) 
names(res[[3]])[3] <- "plot"
```

# ICC
```{r Plot ICC, message= FALSE, warning = FALSE}
plot[[3]] <- ggplot2::ggplot(res[[3]][[3]], aes(x = ICC_type, y = ICC, color = interaction(ICC_type, Target))) +
  ggplot2::geom_errorbar(aes(ymin = LLCI, ymax = ULCI), width = 0.1, size = 2) +
  ggplot2::geom_point(size = 5) +
  ggplot2::coord_flip() + #flips the x and y axes of a plot
  ggplot2::scale_x_discrete() +
  ggplot2::scale_y_continuous(limits = c(-0.5, 1), 
                     sec.axis = sec_axis(~., breaks = c(0, 0.5, 0.7, 1), 
                                             labels = c("unacceptable", "poor", "acceptable", "excellent")),
                                             breaks = seq(-0.5, 1,by = 0.1)) +
  ggplot2::geom_hline(yintercept = 0, linetype = "dotted", color = "black", size = 1, alpha = 0.5) + #add dotted line
  ggplot2::geom_hline(yintercept = 0.5, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_hline(yintercept = 0.7, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  ggplot2::geom_hline(yintercept = 1, linetype = "dotted", color = "black", size = 1, alpha = 0.5) +
  papaja::theme_apa() +
  ggplot2::theme(legend.position = "none") +
  ggplot2::labs(y = "Intraclass Correlation Coefficient", x = "Indices") +
  ggplot2::scale_color_manual(values = c(palette$warm, palette$cold)) + 
  ggplot2::facet_wrap(~ type + Target, ncol = 1) 

names(plot)[3] <- "ICC"

ggsave(filename="./FIGURE/Fig3_ICC.png", width = 9, height = 12, dpi = 300)
```