---
title: "Untitled"
author: "yuki"
date: "2023-08-23"
output: html_document
---
```{r}
library(R.matlab)
temp <- R.matlab::readMat("../4_Data_Extraction/4_2_Open_Data/Paper_s4/Source/PractExperiment_1_Subject_1_Ses_1_.mat")

```

```{r}
list_mat$TestRt
list_mat$Correct
list_mat$Tshape
list_mat$Tlabel
```

```{r}
list_mat <- R.matlab::readMat("../4_Data_Extraction/4_2_Open_Data/Paper_s4/Source/PractExperiment_1_Subject_1_Ses_1_.mat")

df_rt <- data.frame(
  RT_1 = list_mat$TestRt[,1],
  RT_2 = list_mat$TestRt[,2],
  RT_3 = list_mat$TestRt[,3],
  RT_4 = list_mat$TestRt[,4]
  ) %>%
  tidyr::pivot_longer(
    cols = starts_with("RT_"),
    names_to = "Block",
    names_prefix = "RT_",
    values_to = "RT"
    ) 
  

df_acc <- data.frame(
  ACC_1 = list_mat$Correct[, 1],
  ACC_2 = list_mat$Correct[, 2],
  ACC_3 = list_mat$Correct[, 3],
  ACC_4 = list_mat$Correct[, 4]
  ) %>%
  tidyr::pivot_longer(
    cols = starts_with("ACC_"),
    names_to = "Block",
    names_prefix = "ACC_",
    values_to = "ACC"
    ) %>%
  dplyr::select(-Block)

df_sha <- data.frame(
  Shape_1 = list_mat$Tshape[, 1],
  Shape_2 = list_mat$Tshape[, 2],
  Shape_3 = list_mat$Tshape[, 3],
  Shape_4 = list_mat$Tshape[, 4]
  ) %>%
  tidyr::pivot_longer(
    cols = starts_with("Shape_"),
    names_to = "Block",
    names_prefix = "Shape_",
    values_to = "Shape"
    ) %>%
  dplyr::select(-Block)

df_lab <- data.frame(
  Label_1 = list_mat$Tlabel[, 1],
  Label_2 = list_mat$Tlabel[, 2],
  Label_3 = list_mat$Tlabel[, 3],
  Label_4 = list_mat$Tlabel[, 4]
  ) %>%
  tidyr::pivot_longer(
    cols = starts_with("Label_"),
    names_to = "Block",
    names_prefix = "Label_",
    values_to = "Label"
    ) %>%
  dplyr::select(-Block)

df_mat <- data.frame(Subject = list_mat$num,
                     Session = list_mat$ses,
                     df_sha, df_lab,
                     df_rt, df_acc)

```

```{r}
# 获取文件夹内所有满足条件的文件名
file_list <- list.files(path = "../4_Data_Extraction/4_2_Open_Data/Paper_s4/Source/", pattern = "^PractExperiment_1.*\\.mat$", full.names = TRUE)

# 创建一个空的列表来存储读取的.mat文件
list_mat_e1 <- list()

# 循环读取文件并存储到列表中
for (file in file_list) {
  mat_data <- readMat(file)
  list_mat_e1[[basename(file)]] <- mat_data
}

```

```{r}
read.mat <- function(list) {
  
  res <- list()
  
  for (i in 1:length(list)) {
    list_mat <- list[[i]]
    df_rt <- data.frame(
      RT_1 = list_mat$TestRt[,1],
      RT_2 = list_mat$TestRt[,2],
      RT_3 = list_mat$TestRt[,3],
      RT_4 = list_mat$TestRt[,4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("RT_"),
        names_to = "Block",
        names_prefix = "RT_",
        values_to = "RT"
        ) 
      
    df_acc <- data.frame(
      ACC_1 = list_mat$Correct[, 1],
      ACC_2 = list_mat$Correct[, 2],
      ACC_3 = list_mat$Correct[, 3],
      ACC_4 = list_mat$Correct[, 4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("ACC_"),
        names_to = "Block",
        names_prefix = "ACC_",
        values_to = "ACC"
        ) %>%
      dplyr::select(-Block)
    
    df_sha <- data.frame(
      Shape_1 = list_mat$Tshape[, 1],
      Shape_2 = list_mat$Tshape[, 2],
      Shape_3 = list_mat$Tshape[, 3],
      Shape_4 = list_mat$Tshape[, 4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("Shape_"),
        names_to = "Block",
        names_prefix = "Shape_",
        values_to = "Shape"
        ) %>%
      dplyr::select(-Block)
    
    df_lab <- data.frame(
      Label_1 = list_mat$Tlabel[, 1],
      Label_2 = list_mat$Tlabel[, 2],
      Label_3 = list_mat$Tlabel[, 3],
      Label_4 = list_mat$Tlabel[, 4]
      ) %>%
      tidyr::pivot_longer(
        cols = starts_with("Label_"),
        names_to = "Block",
        names_prefix = "Label_",
        values_to = "Label"
        ) %>%
      dplyr::select(-Block)
    
    df_mat <- data.frame(Subject = list_mat$num,
                         Session = list_mat$ses,
                         df_sha, df_lab,
                         df_rt, df_acc)
    
    res[[i]] <- df_mat
  }
  df <- do.call(rbind, res)
  return(df)
}
```

```{r}
df[[21]] <- read.mat(list = list_mat_e1)
```

