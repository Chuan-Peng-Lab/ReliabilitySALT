---
title: "3_Reliability"
author: "yuki"
date: "2023-04-30"
output: html_document
---
# Create NULL List
```{r Create NULL List}
res <- list()
```

# First-Second, Odd-Even, Permuted
```{r Name Self - Friend}
res[[1]] <- list()
names(res)[1] <- "Normal SHR"
```

```{r nmshr one by one, message=FALSE, warning=FALSE}
Start_Time <- Sys.time()
df_rt <- yukiBP::shr(list = shl[1:3], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "rt", mc = FALSE, nc = 8)
df_acc <- yukiBP::shr(list = shl[1:3], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "acc", mc = FALSE, nc = 8)
df_dp <- yukiBP::shr(list = shl[1:3], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "dp", mc = FALSE, nc = 8)
df_eff <- yukiBP::shr(list = shl[1:3], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "eff", mc = FALSE, nc = 8)
df_ezddm <- yukiBP::shr(list = shl[1:3], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "ezddm", mc = FALSE, nc = 8)
df_rwddm <- yukiBP::shr(list = shl[1:3], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "rwddm", mc = FALSE, nc = 8)
End_Time <- Sys.time()
```

```{r Rbind 6 Indices}
res[[1]] <- rbind(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm) %>%
  dplyr::mutate(Indice = case_when(Indice == "rt" ~ "RT",
                                   Indice == "acc" ~ "ACC",
                                   Indice == "dp" ~ "d Prime",
                                   Indice == "eff" ~ "Efficiency",
                                   Indice == "ez_v" ~ "ezDDM v",
                                   Indice == "ez_z" ~ "ezDDM z",
                                   Indice == "rw_v" ~ "rwDDM v",
                                   Indice == "rw_z" ~ "rwDDM z",)
                ) %>%
  dplyr::mutate(Indice = factor(Indice, levels = c("RT", "ACC", "d Prime", "Efficiency", "ezDDM v", "ezDDM z", "rwDDM v", "rwDDM z")),
                Method = factor(Method, levels = c("First-Second", "Odd-Even", "Permuted")),
                Target = factor(Target),
                ) %>%
  dplyr::select(Target, Indice, Method, r, Paper_ID) %>%
  dplyr::arrange(Target, Indice, Method)

rm(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm)
```

```{r Save nmshr}
write.csv(x = res[[1]], file = "./OUTPUT/nmshr_P0S1.csv", row.names = FALSE)
```

```{r function: lazy_nmshr}
lazy_nmshr <- function(Target, Paper_ID) {
  
  # 计算8个参数的分半信度 
  df_rt <<- yukiBP::shr(list = shl[1:3], Target = Target, Paper_ID = Paper_ID, Indice = "rt", mc = FALSE, nc = 8)
  df_acc <<- yukiBP::shr(list = shl[1:3], Target = Target, Paper_ID = Paper_ID, Indice = "acc", mc = FALSE, nc = 8)
  df_dp <<- yukiBP::shr(list = shl[1:3], Target = Target, Paper_ID = Paper_ID, Indice = "dp", mc = FALSE, nc = 8)
  df_eff <<- yukiBP::shr(list = shl[1:3], Target = Target, Paper_ID = Paper_ID, Indice = "eff", mc = FALSE, nc = 8)
  df_ezddm <<- yukiBP::shr(list = shl[1:3], Target = Target, Paper_ID = Paper_ID, Indice = "ezddm", mc = FALSE, nc = 8)
  df_rwddm <<- yukiBP::shr(list = shl[1:3], Target = Target, Paper_ID = Paper_ID, Indice = "rwddm", mc = FALSE, nc = 8)
  
  # 合并8个参数到一个表格内
  res[[1]] <<- rbind(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm) %>%
  dplyr::mutate(Indice = case_when(Indice == "rt" ~ "RT",
                                   Indice == "acc" ~ "ACC",
                                   Indice == "dp" ~ "d Prime",
                                   Indice == "eff" ~ "Efficiency",
                                   Indice == "ez_v" ~ "ezDDM v",
                                   Indice == "ez_z" ~ "ezDDM z",
                                   Indice == "rw_v" ~ "rwDDM v",
                                   Indice == "rw_z" ~ "rwDDM z",)
                ) %>%
  dplyr::mutate(Indice = factor(Indice, levels = c("RT", "ACC", "d Prime", "Efficiency", "ezDDM v", "ezDDM z", "rwDDM v", "rwDDM z")),
                Method = factor(Method, levels = c("First-Second", "Odd-Even", "Permuted")),
                Target = factor(Target),
                ) %>%
  dplyr::select(Target, Indice, Method, r, Paper_ID) %>%
  dplyr::arrange(Target, Indice, Method)

  rm(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm)
  
  # 保存生成的表格
  Path <- paste0("./OUTPUT/nmshr_", Paper_ID, ".csv")
  write.csv(x = res[[1]], file = Path, row.names = FALSE)

}
```

```{r laze_nmshr, message=FALSE, warning=FALSE}
lazy_nmshr(Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1")
```


################################################################################
--------------------------------------------------------------------------------
################################################################################


# Monte Carlo
```{r Name Self - Friend}
res[[2]] <- list()
names(res)[2] <- "Monte-Carlo SHR"
```

```{r mcshr one by one, message=FALSE, warning=FALSE}
Start_Time <- Sys.time()
df_rt <- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "rt", mc = TRUE, nc = 16)
df_acc <- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "acc", mc = TRUE, nc = 16)
df_dp <- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "dp", mc = TRUE, nc = 16)
df_eff <- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "eff", mc = TRUE, nc = 16)
df_ezddm <- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "ezddm", mc = TRUE, nc = 16)
df_rwddm <- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "rwddm", mc = TRUE, nc = 16)
End_Time <- Sys.time()
```

```{r Rbind 6 Indices}
res[[2]] <- rbind(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm) %>%
  dplyr::mutate(Indice = case_when(Indice == "rt" ~ "RT",
                                   Indice == "acc" ~ "ACC",
                                   Indice == "dp" ~ "d Prime",
                                   Indice == "eff" ~ "Efficiency",
                                   Indice == "ez_v" ~ "ezDDM v",
                                   Indice == "ez_z" ~ "ezDDM z",
                                   Indice == "rw_v" ~ "rwDDM v",
                                   Indice == "rw_z" ~ "rwDDM z",)
                ) %>%
  dplyr::mutate(Indice = factor(Indice, levels = c("RT", "ACC", "d Prime", "Efficiency", "ezDDM v", "ezDDM z", "rwDDM v", "rwDDM z")),
                Target = factor(Target),
                ) %>%
  dplyr::select(Target, Indice, r, LLCI, ULCI, Paper_ID) %>%
  dplyr::arrange(Target, Indice)

rm(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm)
```

```{r Save mcshr_friend}
write.csv(x = res[[2]][[1]],
          file = "./OUTPUT/mcshr_P0S1.csv",
          row.names = FALSE,
          )
```

```{r function: lazy_mcshr}
lazy_mcshr <- function(Target, Paper_ID) {
  
  # 计算8个参数的分半信度 
  df_rt <<- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "rt", mc = TRUE, nc = 16)
  df_acc <<- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "acc", mc = TRUE, nc = 16)
  df_dp <<- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "dp", mc = TRUE, nc = 16)
  df_eff <<- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "eff", mc = TRUE, nc = 16)
  df_ezddm <<- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "ezddm", mc = TRUE, nc = 16)
  df_rwddm <<- yukiBP::shr(list = shl[[4]], Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1", Indice = "rwddm", mc = TRUE, nc = 16)
  
  # 合并8个参数到一个表格内
  res[[2]] <<- rbind(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm) %>%
  dplyr::mutate(Indice = case_when(Indice == "rt" ~ "RT",
                                   Indice == "acc" ~ "ACC",
                                   Indice == "dp" ~ "d Prime",
                                   Indice == "eff" ~ "Efficiency",
                                   Indice == "ez_v" ~ "ezDDM v",
                                   Indice == "ez_z" ~ "ezDDM z",
                                   Indice == "rw_v" ~ "rwDDM v",
                                   Indice == "rw_z" ~ "rwDDM z",)
                ) %>%
  dplyr::mutate(Indice = factor(Indice, levels = c("RT", "ACC", "d Prime", "Efficiency", "ezDDM v", "ezDDM z", "rwDDM v", "rwDDM z")),
                Target = factor(Target),
                ) %>%
  dplyr::select(Target, Indice, r, LLCI, ULCI, Paper_ID) %>%
  dplyr::arrange(Target, Indice)

  rm(df_rt, df_acc, df_dp, df_eff, df_ezddm, df_rwddm)
  
    # 保存生成的表格
  Path <- paste0("./OUTPUT/nmshr_", Paper_ID, ".csv")
  write.csv(x = res[[2]], file = Path, row.names = FALSE)
  
}
```

```{r laze_mcshr, message=FALSE, warning=FALSE}
lazy_mcshr(Target = c("Self", "Friend", "Stranger"), Paper_ID = "P0S1")
```
