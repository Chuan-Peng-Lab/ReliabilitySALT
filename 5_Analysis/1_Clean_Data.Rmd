---
title: "data clean"
author: "yuki"
date: "2023-03-25"
output: html_document
---
# Package
```{r Package, warning = FALSE,message = FALSE}
# clean data
library(tidyr)
library(dplyr)
library(stringr)
# More efficient
library(data.table)
# for ICC
library(psych)
# for DDM
library(hausekeep) # ez ddm
library(RWiener) # RW ddm
# plot
library(ggplot2)
library(see)
library(patchwork)
# Parallel Computing
library(foreach)
library(parallel)
library(iterators)
library(doParallel)
# meta analysis
library(metafor)

# local packages: yukiSH & yukiBP
# You can install them from ".tar.gz" or GitHub

# install.packages("./PACKAGES/yukiSH_0.0.2.tar.gz") # nolint
# devtools::install_github("yuki-961004/yukiSH") # nolint
library(yukiSH)

# install.packages("./PACKAGES/yukiBP_0.1.3.tar.gz") # nolint
# devtools::install_github("yuki-961004/yukiBP") # nolint
library(yukiBP)
```

# Data.Frame List
```{r Data.Frame List}
df <- list()
```

# Paper 0
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper 0}
df[[1]] <- read.csv("../4_Data_Extraction/4_1_Raw_Data/SPMT_raw.csv") %>%
  dplyr::filter(Emotion == "control",
                !is.na(BlockList.Sample),
                !(Subject %in% c(6008, 6015, 6031)),
                ) %>%
  dplyr::mutate(Matching = case_when(Match == "Match" ~ "Matching",
                                     Match == "Nonmatch" ~ "Nonmatching")) %>%
  dplyr::mutate(Subject = as.numeric(Subject),
                Matching = factor(Matching,
                                  levels = c("Matching", "Nonmatching")),
                Identity = factor(Identity,
                                  levels = c("Self", "Friend", "Stranger")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[1] <- "Paper 0 Exp 1"
summary(df[[1]])
write.csv(x = df[[1]], file = "./DATA/df_1.csv")
```

# Paper 6 
## Experiment 1 (Identtiy = 3)
"Self", "Partner", "Stranger"
```{r Paper 6}
df[[2]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_6/P6_Exp1_raw.csv") %>% # nolint
  dplyr::filter(Phase == 1,
                rt != "None") %>%
  dplyr::select(Subject = Pair.Number,
                Matching = Condition,
                Identity = Shape,
                Session = ShapeLoc,
                RT_sec = rt,
                ACC = corr) %>%
  dplyr::mutate(Matching = case_when(Matching == "Match" ~ "Matching",
                                     Matching == "Mismatch" ~ "Nonmatching"),
                Identity = ifelse(Identity == "P1", "Self", ifelse(Identity == "P2", "Partner", Identity)), # nolint
                Session = ifelse(Session == "Top", 1, ifelse(Session == "Bottom", 2, Session)), # nolint
                RT_sec = as.numeric(RT_sec),
                RT_ms = RT_sec * 1000,
                ) %>% # nolint
  dplyr::mutate(Subject = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Partner", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[2] <- "Paper 6 Exp 1"
summary(df[[2]])
write.csv(x = df[[2]], file = "./DATA/df_2.csv")
```

# Paper 46 (Dark Light Box)
## Experiment 2 (Identtiy = 2)
"Self", "Stranger"
```{r Paper 46}
df[[3]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_46/Exp2/P46_Exp2_raw.csv")  %>% # nolint
  dplyr::filter(rt != "None") %>%
  dplyr::select(Subject = Subject,
                Matching = Condition,
                Identity = Shape,
                Session = ShapeLoc,
                RT_sec = rt,
                ACC = corr) %>%
  # 转化为标准化的名称
  dplyr::mutate(Matching = case_when(Matching == "Match" ~ "Matching",
                                     Matching == "Mismatch" ~ "Nonmatching"),
                Session = ifelse(Session == "Top", 1, ifelse(Session == "Bottom", 2, Session)), # nolint
                RT_sec = as.numeric(RT_sec),
                RT_ms = RT_sec * 1000,
                ) %>%
  # 统一变量的属性
  dplyr::mutate(Subject = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Stranger")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[3] <- "Paper 46 Exp 2"
summary(df[[3]])
write.csv(x = df[[3]], file = "./DATA/df_3.csv")
```

# Paper 51 
## Experiment 1 (Identtiy = 3)
"Self", "Celebrity", "Stranger"
```{r Paper 51 Experiment 1}
df[[4]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_51/P51_Exp1_raw.csv") %>% # nolint
  tidyr::separate(condition, into = c("Identity", "Match"), sep = "-shape_") %>%
  dplyr::mutate(Identity = case_when(Identity == "Self" ~ "Self",
                                     Identity == "Familiar" ~ "Celebrity",
                                     Identity == "Stranger" ~ "Stranger"),
                Matching = case_when(Match == "Matched" ~ "Matching",
                                     Match == "Mismatched" ~ "Nonmatching"),
                Session = case_when(Session == "S1" ~ 1,
                                    Session == "S2" ~ 2,
                                    Session == "S3" ~ 3,
                                    Session == "S4" ~ 4),
                RT_ms = as.numeric(respond3.RT),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(respond3.ACC),
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Celebrity", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[4] <- "Paper 51 Exp 1"
summary(df[[4]])
write.csv(x = df[[4]], file = "./DATA/df_4.csv")
```

## Experiment 2 (Identtiy = 2)
"Self", "Celebrity"
```{r Paper 51 Experiment 2}
df[[5]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_51/P51_Exp2_raw.csv") %>% # nolint
  dplyr::filter(condition1level == "No cue") %>%
  tidyr::separate(condition1correct, into = c("Identity", "Matching"), sep = "-shape_") %>% # nolint
  dplyr::mutate(Subject = Subject,
                Identity = case_when(Identity == "Self" ~ "Self",
                                     Identity == "Familiar" ~ "Celebrity"),
                Matching = case_when(Matching == "Matched" ~ "Matching",
                                     Matching == "Mismatched" ~ "Nonmatching"),
                Session = 1,
                RT_ms = as.numeric(respond3.RT),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(respond3.ACC)
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Celebrity")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[5] <- "Paper 51 Exp 2"
summary(df[[5]])
write.csv(x = df[[5]], file = "./DATA/df_5.csv")
```

# Paper 54 
## Experiment 1 (Identtiy = 4)
"Self", "Mother","none", "Acquaintance"
```{r Paper 54 Experiment 1}
df[[6]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_54/P54_Exp1_raw.csv") %>% # nolint
  dplyr::filter(Procedure.Trial. == "FLproc") %>%
  dplyr::mutate(Subject = as.numeric(Subject),
                Matching = case_when(FLbed == "comp" ~ "Matching",
                                     FLbed == "incomp" ~ "Nonmatching"),
                Identity = case_when(flanker == "Ich" ~ "Self",
                                     flanker == "Mutter" ~ "Mother",
                                     flanker == "none" ~ "none",
                                     flanker == "Bekannter" ~ "Acquaintance"),
                Session = 1,
                RT_ms = fl.RT,
                RT_sec = fl.RT / 1000,
                ACC = as.numeric(fl.ACC)) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Mother", "none", "Acquaintance")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[6] <- "Paper 54 Exp 1"
summary(df[[6]])
write.csv(x = df[[6]], file = "./DATA/df_6.csv")
```

## Experiment 3 (Identtiy = 3)
"Self", "Mother", "Acquaintance"
```{r Paper 54 Experiment 3}
df[[7]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_54/P54_Exp3_raw.csv") %>% # nolint
  dplyr::filter(Procedure == "RPproc") %>%
  dplyr::mutate(Subject = as.numeric(Subject),
                Matching = case_when(Match == "comp" ~ "Matching",
                                     Match == "incomp" ~ "Nonmatching"),
                Identity = case_when(Identity == "Ich" ~ "Self",
                                     Identity == "Mutter" ~ "Mother",
                                     Identity == "Bekannter" ~ "Acquaintance"),
                Session = 1,
                RT_ms = RT,
                RT_sec = RT / 1000,
                ACC = as.numeric(ACC)) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Mother", "Acquaintance")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[7] <- "Paper 54 Exp 3"
summary(df[[7]])
write.csv(x = df[[7]], file = "./DATA/df_7.csv")
```

# Paper n4
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n4 Experiment 1}
df[[8]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n4/Pn4_Exp1_raw.csv") %>% # nolint
  dplyr::filter(blocktype == "mixed") %>%
  dplyr::mutate(Subject = as.numeric(subject),
                Matching = case_when(type == "match" ~ "Matching",
                                     type == "nonmatch" ~ "Nonmatching"),
                Identity = as.character(shape),
                Session = 1,
                RT_ms = as.numeric(latency),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(correct)) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[8] <- "Papaer n4 Exp 1"
summary(df[[8]])
write.csv(x = df[[8]], file = "./DATA/df_8.csv")
```

# Paper n13
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n13 Experiment 1}
df[[9]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n13/Exp1/Pn13_Exp1_raw.csv") %>% # nolint
  dplyr::select(Subject,
                Shape = Stimulus,
                Label = Word,
                CloseShape,
                MediumShape,
                FarShape,
                RT = Target.RT,
                ACC = Target.ACC) %>%
  dplyr::mutate(Identity = case_when(Shape == CloseShape ~ "Self",
                                     Shape == MediumShape ~ "Friend",
                                     Shape == FarShape ~ "Stranger",
                                     TRUE ~ Shape),
                # 需要先转化Identity，然后在判断是否匹配
                Matching = if_else(Identity == Label, "Matching", "Nonmatching"), # nolint
                Session = 1,
                RT_ms = as.numeric(RT),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[9] <- "Papaer n13 Exp 1"
summary(df[[9]])
write.csv(x = df[[9]], file = "./DATA/df_9.csv")
```

## Experiment 3 (Identtiy = 3)
"Self", "Father", "Stranger"
```{r Paper n13 Experiment 3}
df[[10]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n13/Exp3/Pn13_Exp3_raw.csv") %>% # nolint
  dplyr::select(Subject,
                Shape = Stimulus,
                Label = Word,
                CloseShape,
                MediumShape,
                FarShape,
                RT = Target.RT,
                ACC = Target.ACC) %>%
  dplyr::mutate(Identity = case_when(Shape == CloseShape ~ "Self",
                                     Shape == MediumShape ~ "Father",
                                     Shape == FarShape ~ "Stranger",
                                     TRUE ~ Shape),
                Matching = if_else(Identity == Label, "Matching", "Nonmatching"), # nolint
                Session = 1,
                RT_ms = as.numeric(RT),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Father", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[10] <- "Papaer n13 Exp 3"
summary(df[[10]])
write.csv(x = df[[10]], file = "./DATA/df_10.csv")
```

## Experiment 4 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n13 Experiment 4}
df[[11]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n13/Exp4/Pn13_Exp4_raw.csv") %>% # nolint
  dplyr::select(Subject,
                Shape = Stimulus,
                Label = Word,
                CloseShape,
                MediumShape,
                FarShape,
                RT = Target.RT,
                ACC = Target.ACC) %>%
  dplyr::mutate(Identity = case_when(Shape == CloseShape ~ "Self",
                                     Shape == MediumShape ~ "Friend",
                                     Shape == FarShape ~ "Stranger",
                                     TRUE ~ Shape),
                Matching = if_else(Identity == Label, "Matching", "Nonmatching"), # nolint
                Session = 1,
                RT_ms = as.numeric(RT),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[11] <- "Papaer n13 Exp 4"
summary(df[[11]])
write.csv(x = df[[11]], file = "./DATA/df_11.csv")
```

# Paper n16
## Experiment 1 (Identtiy = 2)
"Self", "Friend"
```{r Paper n16 Experiment 1}
df[[12]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n16/Pn16_Exp1_raw.csv") %>% # nolint
  dplyr::select(Subject = Participant..,
                Matching = Trial.Type,
                Identity = Shape.Association,
                RT_ms = Reponse.Time,
                ACC = Target.Accuracy) %>%
  dplyr::mutate(Session = 1,
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[12] <- "Papaer n16 Exp 1"
summary(df[[12]])
write.csv(x = df[[12]], file = "./DATA/df_12.csv")
```

## Experiment 2 (Identtiy = 2)
"Self", "Friend"
```{r Paper n16 Experiment 2}
df[[13]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n16/Pn16_Exp2_raw.csv") %>% # nolint
  dplyr::select(Subject = Participant,
                Matching = Trial.Type,
                Identity = Shape.Association,
                RT_ms = Response.Time,
                ACC = Target.Accuracy) %>%
  dplyr::mutate(Session = 1,
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[13] <- "Papaer n16 Exp 2"
summary(df[[13]])
write.csv(x = df[[13]], file = "./DATA/df_13.csv")
```

## Experiment 3 (Identtiy = 2)
"Self", "Friend"
```{r Paper n16 Experiment 3}
df[[14]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n16/Pn16_Exp3_raw.csv") %>% # nolint
  dplyr::select(Subject = Participant,
                Matching = Trial.Type,
                Identity = Shape.Association,
                RT_ms = Response.Time,
                ACC = Target.Accuracy) %>%
  dplyr::mutate(Session = 1,
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[14] <- "Papaer n16 Exp 3"
summary(df[[14]])
write.csv(x = df[[14]], file = "./DATA/df_14.csv")
```

# Paper n23
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper n23 Experiment 1}
df[[15]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_n23/Pn23_Exp1_raw.csv") %>% # nolint
  dplyr::select(Subject = Subject,
                Matching = Correctanswer,
                Identity = Shape,
                Session = Group,
                RT_ms = iti.RT,
                ACC = iti.ACC,
                ) %>%
  dplyr::mutate(Matching = case_when(Matching == "j" ~ "Matching",
                                     Matching == "f" ~ "Nonmatching"),
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000,
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[15] <- "Papaer n23 Exp 1"
summary(df[[15]])
write.csv(x = df[[15]], file = "./DATA/df_15.csv")
```

# Paper 95 (Face)
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper 95 Experiment 1}
df[[16]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_95/P95_Exp1_raw.csv") %>% # nolint
  dplyr::filter(PracticeMode == "No") %>%
  dplyr::select(Subject,
                Label = Cue,
                Shape = Stimulus,
                Session = Face_Gender,
                RT_ms = Cue.RT,
                ACC = Cue.ACC) %>%
  dplyr::mutate(Shape = case_when(Shape == "shape1.jpg" ~ "Self",
                                  Shape == "shape2.jpg" ~ "Friend",
                                  Shape == "shape3.jpg" ~ "Stranger",
                                  is.na(Shape) ~ NA_character_,
                                  TRUE ~ Shape),
                Label = case_when(Label == "You" ~ "Self",
                                  Label == "Friend" ~ "Friend",
                                  Label == "Stranger" ~ "Stranger",
                                  is.na(Label) ~ NA_character_,
                                  TRUE ~ Label),
                Matching = if_else(Shape == Label, "Matching", "Nonmatching"),
                Identity = Shape,
                Session = case_when(Session == "F" ~ 1,
                                    Session == "M" ~ 2),
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[16] <- "Paper 95 Exp 1"
summary(df[[16]])
write.csv(x = df[[16]], file = "./DATA/df_16.csv")
```

## Experiment 2 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper 95 Experiment 2}
df[[17]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_95/P95_Exp2_raw.csv") %>% # nolint
  dplyr::filter(PracticeMode == "No") %>%
  dplyr::select(Subject,
                Label = Cue,
                Shape = Stimulus,
                Session = Face_Gender,
                RT_ms = Stimulus.RT,
                ACC = Stimulus.ACC) %>% # nolint
  dplyr::mutate(Shape = case_when(Shape == "shape1.jpg" ~ "Self",
                                  Shape == "shape2.jpg" ~ "Friend",
                                  Shape == "shape3.jpg" ~ "Stranger",
                                  is.na(Shape) ~ NA_character_,
                                  TRUE ~ Shape),
                Label = case_when(Label == "You" ~ "Self",
                                  Label == "Friend" ~ "Friend",
                                  Label == "Stranger" ~ "Stranger",
                                  is.na(Label) ~ NA_character_,
                                  TRUE ~ Label),
                Matching = if_else(Shape == Label, "Matching", "Nonmatching"),
                Identity = Shape,
                Session = case_when(Session == "F" ~ 1,
                                    Session == "M" ~ 2),
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[17] <- "Paper 95 Exp 2"
summary(df[[17]])
write.csv(x = df[[17]], file = "./DATA/df_17.csv")
```

# Paper s1 (Face)
## Experiment 1 (Identtiy = 2)
"Self", "Stranger"
```{r Paper s1 Experiment 1}
df_Ps1_E1 <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_s1/Ps1_Exp1_raw.csv") %>% # nolint
  dplyr::select(Subject = Participant.Public.ID,
                Match = P_Orginal,
                Identity = P_Group,
                RT_ms = Reaction.Time,
                ACC = Correct) %>%
  dplyr::mutate(Matching = case_when(Match == "JA" ~ "Matching",
                                     Match == "NEIN" ~ "Nonmatching"),
                Identity = case_when(Identity == "User" ~ "Self",
                                     Identity == "Other" ~ "Stranger"),
                Session = 1,
                RT_ms = as.numeric(RT_ms),
                RT_sec = RT_ms / 1000,
                ACC = as.numeric(ACC))

df_Subject_ID <- df_Ps1_E1 %>% # nolint
  dplyr::group_by(Subject) %>%
  dplyr::summarise(count = n()) %>%
  dplyr::mutate(Subject_ID = row_number()) %>%
  dplyr::select(Subject, Subject_ID)

df[[18]] <- df_Ps1_E1 %>%
  dplyr::left_join(df_Subject_ID, by = "Subject") %>%
  dplyr::mutate(Subject = Subject_ID) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Stranger")),
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

rm(df_Subject_ID, df_Ps1_E1)

names(df)[18] <- "Paper s1 Exp 1"
summary(df[[18]])
write.csv(x = df[[18]], file = "./DATA/df_18.csv")
```

# Paper s2
## Experiment 1 (Identtiy = 2)
"Self", "Stranger"
```{r Paper s2 Experiment 1}
df[[19]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_s2/Ps2_Exp1_raw.csv") %>%
  dplyr::filter(Session != 3,
                !(Subject %in% c(6205, 6209, 6223)),
                ) %>%
  dplyr::select(Subject = Subject,
                Matching = CorrectAnswer,
                Identity = identity,
                Session = Session,
                RT = Target.RT,
                ACC = Target.ACC) %>%
  dplyr::mutate(Matching = case_when(Matching == "m" ~ "Matching",
                                     Matching == "k" ~ "Nonmatching"),
                Identity = case_when(Identity == "self" ~ "Self",
                                     Identity == "other" ~ "Stranger"),
                RT_ms = as.numeric(RT),
                RT_sec = RT_ms / 1000,
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[19] <- "Paper s2 Exp 1"
summary(df[[19]])
write.csv(x = df[[19]], file = "./DATA/df_19.csv")
```

# Paper s3
## Experiment 1 (Identtiy = 3)
"Self", "Friend", "Stranger"
```{r Paper s3 Experiment 1}
df[[20]] <- read.csv("../4_Data_Extraction/4_2_Open_Data/Paper_s3/Ps3_Exp1_raw.csv") %>%
  dplyr::select(Subject = Subject,
                Session = Session,
                Group = Block,
                Shape = SelfRelated,
                Label = Question, 
                RT_ms = RT,
                ACC = ACC,
                ) %>%
  dplyr::mutate(Label = case_when(Label == "You" ~ "Self",
                                  TRUE ~ Label),
                Matching = case_when(Shape == Label ~ "Matching",
                                     Shape != Label ~ "Nonmatching"),
                RT_sec = RT_ms / 1000,
                Identity = Shape
                ) %>%
  dplyr::mutate(Subjcet = as.numeric(Subject),
                Matching = factor(Matching, levels = c("Matching", "Nonmatching")), # nolint
                Identity = factor(Identity, levels = c("Self", "Friend","Stranger")), # nolint
                Session = as.factor(Session),
                RT_ms = as.numeric(RT_ms),
                RT_sec = as.numeric(RT_sec),
                ACC = as.numeric(ACC),
                ) %>%
  dplyr::select(Subject, Matching, Identity, Session, RT_ms, RT_sec, ACC) %>%
  dplyr::mutate(RT_sec = round(RT_sec, 3),
                RT_ms = round(RT_ms, 0)) %>%
  dplyr::filter(RT_sec >= 0.2 & RT_sec <= 1.5,
                ACC == 1 | ACC == 0) %>%
  dplyr::arrange(Subject, Matching, Identity, Session)

names(df)[20] <- "Paper s3 Exp 1"
summary(df[[20]])
write.csv(x = df[[20]], file = "./DATA/df_20.csv")
```

# Check ACC
```{r}
min_ACC_list <- list()

for (i in 1:19) {
  min_ACC <- df[[i]] %>%
    dplyr::group_by(Subject) %>%
    dplyr::summarise(mean_ACC = mean(ACC)) %>%
    dplyr::ungroup() %>%
    dplyr::filter(mean_ACC < 0.5) %>%
    dplyr::arrange(mean_ACC)
  
  min_ACC_list[[i]] <- min_ACC
  cat("For df[[", i, "]], the min ACC is:", min(min_ACC$mean_ACC), "\n")
}

rm(min_ACC, i)
```

```{r}
for (i in 1:length(df)) {
  filtered_df <- df[[i]] %>%
    dplyr::anti_join(min_ACC_list[[i]], by = "Subject") 
  
  df[[i]] <- filtered_df
  write.csv(x = filtered_df, file = paste0("./DATA/df_", i, ".csv"), row.names = FALSE)
}

rm(filtered_df, i)
```


