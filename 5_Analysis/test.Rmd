---
title: "test"
author: "yuki"
date: "2023-06-03"
output: html_document
---

```{r}
df_test <- df[[1]] %>%
  dplyr::filter(Subject == 6018 | Subject == 6019 | Subject == 6020 | Subject == 6021 | Subject == 6022) 
```
# 1-5 good
# 6-11 good, 但是负数很多
# 12-17 good
# 18-22 find someone

```{r}
df_test <- df[[1]] %>%
  dplyr::filter(Subject == 6020) 
```

```{r}
unique(df[[1]]$Subject)
```


```{r}
shl_test <- list()
```

# First-Second
```{r First-Second SHR}
shl_test[[1]] <- yukiSH::sh_tool(df.split = df_test, method = "fs", sub = "Subject", var1 = "Matching", var2 = "Identity", var3 = "Session")
```
# Odd-Even
```{r Odd-Even SHR}
shl_test[[2]] <- yukiSH::sh_tool(df.split = df_test, method = "od", sub = "Subject", var1 = "Matching", var2 = "Identity", var3 = "Session")
```
# Permuted
```{r Permuted SHR}
shl_test[[3]] <- yukiSH::sh_tool(df.split = df_test, method = "permuted", sub = "Subject", var1 = "Matching", var2 = "Identity", var3 = "Session")
```
# Monte Carlo
```{r}
shl_test[[4]] <- yukiSH::sh_tool(df.split = df_test, method = "mc", sub = "Subject", var1 = "Matching", var2 = "Identity", var3 = "Session",
                                 iteration = 3, nc = 16)
```

# test nmshr_rwddm
```{r}
df_rwddm <- nmshr_rwddm(list = shl_test[1:3], Target = "Friend", Paper_ID = "P0S1")
```

```{r}
    RW_list_1 <- split(shl_test[[1]][[1]], shl_test[[1]][[1]]$Subject)
    result <- list()
    for(i in 1:length(RW_list_1)) {
      RW_list_1[[i]] <- RW_list_1[[i]] %>%
        # RWiener::wdm 只识别lower upper
        dplyr::mutate(ACC = case_when(ACC == 0 ~ "lower",
                                      ACC == 1 ~ "upper")) 
      result[[i]] <- rwddm(df = RW_list_1[[i]])
    }
    SPE_half_1 <- base::do.call(rbind, result)
```



summary(result1$a)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9187  1.2018  1.4449  1.8841  2.2007  5.4819 

summary(result1$t)

     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
0.0000007 0.2717474 0.3084933 0.2930297 0.3398111 0.4082375 

summary(result1$z)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1530  0.3137  0.4214  0.4293  0.5363  0.7703 

summary(result1$v)

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.706   3.125   3.810   4.309   5.261   8.301 
